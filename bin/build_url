#!/usr/bin/env ruby
require 'build_url'
require 'mail'
require_relative "../lib/build_url/compose"
require_relative "../lib/build_url/mailer"
require 'yaml'

email = YAML::load(File.open('config.yml'))["email"]

if email == "change-me"
  puts "Please enter your email in `build_url/config.yml`"
elsif !email.include?("@gmail")
  puts "You need to enter a gmail email address."
else
  puts "Please enter the second to last line of the build"
  puts "Example: `13:23:47 Publish artifacts to S3 Bucket bucket=mlzAndroid, file=084-5.3.1665-preproduction.apk`"
  build_details = gets.chomp
  url = Compose.build_url(build_details)
  subject = Compose.build_subject(build_details)
  params = {url: url, subject: subject}
  Mailer.mail(params)
  puts url
end
